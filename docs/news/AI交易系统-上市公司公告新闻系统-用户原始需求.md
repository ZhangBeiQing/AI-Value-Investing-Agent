
我想为我的AI 股票交易系统agent新增一个使用官方公告作为news的功能，同时我要支持回测，比如假定今天是以前的2024年1月10日。然后我要搜集这之前的新闻给AI
我暂时把新闻缩小为公司的公告，因为我发现公司公告更权威而且对股价影响很大，我现在打算用这个akshare接口来获取公告信息：
def stock_zh_a_disclosure_report_cninfo(
symbol: str = "000001",
market: str = "沪深京",
keyword: str = "",
category: str = "",
start_date: str = "20230618",
end_date: str = "20231219",
) -> pd.DataFrame:
"""
巨潮资讯-首页-公告查询-信息披露公告
http://www.cninfo.com.cn/new/commonUrl/pageOfSearch?url=disclosure/list/search
:param symbol: 股票代码
:type symbol: str
:param market: choice of {"沪深京", "港股", "三板", "基金", "债券", "监管", "预披露"}
:type market: str
:param keyword: 关键词
:type keyword: str
:param category: choice of {'年报', '半年报', '一季报', '三季报', '业绩预告', '权益分派',
'董事会', '监事会', '股东大会', '日常经营', '公司治理', '中介报告',
'首发', '增发', '股权激励', '配股', '解禁', '公司债', '可转债', '其他融资',
'股权变动', '补充更正', '澄清致歉', '风险提示', '特别处理和退市', '退市整理期'}
:type category: str
:param start_date: 开始时间
:type start_date: str
:param end_date: 开始时间
:type end_date: str
:return: 指定 symbol 的数据
:rtype: pandas.DataFrame
"""
这个接口的输出如下所示，能返回指定时间内的所有公告：
代码,简称,公告标题,公告时间,公告链接
002352,顺丰控股,2025年10月快递物流业务经营简报,2025-11-20 00:00:00,http://www.cninfo.com.cn/new/disclosure/detail?stockCode=002352&announcementId=1224815663&orgId=9900010448&announcementTime=2025-11-20 00:00:00
002352,顺丰控股,关于公司股东与其一致行动人之间内部转让A股股份计划实施完成的公告,2025-11-08 00:00:00,http://www.cninfo.com.cn/new/disclosure/detail?stockCode=002352&announcementId=1224793442&orgId=9900010448&announcementTime=2025-11-08 00:00:00
002352,顺丰控股,H股公告-截至2025年10月31日止月份之股份发行人的证券变动月报表,2025-11-06 00:00:00,http://www.cninfo.com.cn/new/disclosure/detail?stockCode=002352&announcementId=1224788923&orgId=9900010448&announcementTime=2025-11-06 00:00:00
002352,顺丰控股,关于回购公司A股股份的进展公告,2025-11-01 00:00:00,http://www.cninfo.com.cn/new/disclosure/detail?stockCode=002352&announcementId=1224781103&orgId=9900010448&announcementTime=2025-11-01 00:00:00
002352,顺丰控股,关于注销2022年A股股票期权激励计划部分股票期权的公告,2025-10-31 00:00:00,http://www.cninfo.com.cn/new/disclosure/detail?stockCode=002352&announcementId=1224776370&orgId=9900010448&announcementTime=2025-10-31 00:00:00
002352,顺丰控股,上海荣正企业咨询服务（集团）股份有限公司关于顺丰控股股份有限公司2022年A股票期权激励计划预留授予股票期权第三个行权期行权条件成就相关事项之独立财务顾问报告,2025-10-31 00:00:00,http://www.cninfo.com.cn/new/disclosure/detail?stockCode=002352&announcementId=1224776369&orgId=9900010448&announcementTime=2025-10-31 00:00:00
我还写了一个接口来获取stock_zh_a_disclosure_report_cninfo返回的链接地址的文档，测试后非常顺利的获取到了文档。现在的问题是我该怎么组织这些公告给AI，既能用于回测，又不会太冗余或者忽略重要消息，比如很多公司经常发开股东大会的公告，一个股东大会都要发好几个公告，如果都发给AI感觉浪费token。
我有个初步的想法或者流程，你看看行不行。说明一下当前的最新时间为2025年11月20日：
1、任何一只股票，当他第一次加入股票池时，先把它过去一年的所有公告都下载下来保存成pdf
2、以3个月为期限，让AI对公告进行总结，去除冗余的部分，提取出关键信息， 按照时间线保存成json，最终得到一份过去一年所有公告的json，按照时间线排列
3、当用户想要使用这只股票回撤时，可以输入回测时间，比如是2025年6月7日，然后可以指定获取这个时间之前几个月的公告，比如3个月，然后在json中以2025年6月7日为基点，找到最近3个月也就是2025年3月7日到2025年6月7日的新闻公告的json版本返回给用户
4、这个公告更新系统每天晚上更新，然后运行一次stock_zh_a_disclosure_report_cninfo函数，获取当天是否有新的公告，有的话把最近3个月的公告json，和当天新增的公告pdf文档一起让AI分析，保证新的公告不是之前出现过的公告消息，比如开股东大会这个事情，没什么卵用，但是公司都会发好多条公告。
这样使用上面的方法就能实时更新这个公告系统，还能支持回撤
但是这里面有几个问题
	1)、我之前说，在最开始第一次分析公告的时候，需要间隔3个月，把每3个月的公告发给AI，让AI把这3个月的公告总结成json，但问题是。如果这3个月的公告很多，超过了模型处理的上下文该怎么办？
	我想了想，也许可以先计算这3个月内的文档总大小，如果超过一定大小则，将这3个月文档对半，先把一半文档发给AI，总结成json，然后把输出的josn和另外一个半月的公告文档输出AI，让它继续总结，最后变成一个包含最近3个月的json文档。如果把3个月对半后，还是太大则继续对半。
	2)、当时1中我的方法仍然有个巨大的问题。在公司公告中，有一种特殊公告：公司财报。无论我是一季度报、年中、三季度、年终报告，都巨大无比，AI可能一次只能处理一次这样的文档。所以我的想法是，如果在这3个月内检测到和财报相关的文档则把他们单独拿出来，使用一个单独的prompt模板分析，然后把输出结果打入公告总结json。但是这里面也有一个问题。对于公司的财报，我其实是想单独拿一个模块来分析的。比如单独增加一个财报总结系统，对今年甚至往年财报进行一个综合的总结，我不确定在我的这个公告系统中，是不是要让AI简单的对最新的财报做一个总结，然后我的财报系统再做一个更全面的总结？这样能保证公告系统的连续性？但是我担心最后汇总给AI agent的token太多了？？也许应该做些消融实验研究下
	3)、我暂时打算在回测系统中，使用”当前日期“往前3个月的公告作为给AI分析的新闻，当然每份新闻里必须包含最近一个季度的财报公告。这样我觉得这个新闻就比较ok了。但是是否有必要获取更早的公告，比如获取整整2年的公告，然后每次获取过去1年的json公告，再把它发给AI总结一下，剔除对现在股价没有影响的公告，保留一下即使时间超过3个月但依然在影响着当前股价，需要AI关注的公告？但是我又担心新闻的时效性会大大影响AI的判断，比如一个利好最多持续一个月，但是它依然被放到最近的新闻里，其实当前的股价已经因为这个利好涨上天了，超买了，即将大跌。但是AI依然因为这个利好而买了很多中只股票，甚至后面大跌都不想卖出。这个权衡很难办，可能需要多进行消融实验回撤试下

5、在最开始时，对股票池中的所有股票，也就是TRACKED_A_STOCKS中的所有股票，以当前时间为节点，先下载过去一年的所有公告pdf，当然需求要过滤掉无效的公告，然后把这些公告按照需求和详细设计里说的一样，全部整理成按时间排序的json格式。我们需要保存所有从ak.stock_zh_a_disclosure_report_cninfo中获取到的公告，然后保存哪些公告pdf已经下载了，避免重复下载
6、我们需要增加一个函数，比如update函数，可以更新从ak.stock_zh_a_disclosure_report_cninfo获取到的公告信息，如果有新的公告，则下载新的公告pdf，已经下载的就不用下载了
7、我们最终生成的这个json格式的news可以完美替代我在现有项目中的"data\stock_info\北方华创_002371.SZ\news"的news，也就是能和直接兼容。之前这个news是我手动整理的，现在我想换成这套公告自动下载总结系统来生成，新闻news
8、每只股票下载的无论是公告pdf还是缓存后的markdown还是json，都应该保存在对应的股票下面，如北方华创的相关公告都应该放到”data\stock_info\北方华创_002371.SZ“下面
9、需要和这个项目中已有的缓存机制进行兼容

我还有几个额外的要求：
1、progressive_news_summarizer.py中关于pdf文档下载的部分是比较准确的，我测试过效果比较好，整体方法可以保留，细节你可以自由修改
2、progressive_news_summarizer.py中先将pdf转为markdown然后再将多个markdown一起合成一个总的文档放入写好的prompt中。其中把pdf先转换成markdown这一步是可以保留的，因为有些模型不支持直接解析pdf。但是把pdf转成markdown使用marker接口效果很好但是比较慢，所以我打算保留pdf转markdown的实现，把它作为一个可选项。但是我还是希望默认选项能简单的直接把pdf传给AI进行处理，目前我发现了有2个阿里巴巴的Qwen系列模型可以实现这一点，他们分别是
1）、数据挖掘（Qwen-Doc-Turbo）模型，专门用于文档数据挖掘，详情可见官方介绍：https://help.aliyun.com/zh/model-studio/data-mining-qwen-doc?spm=a2c4g.11186623.help-menu-2400256.d_0_1_9_4.e52167338bE8es&scm=20140722.H_2948885._.OR_help-T_cn~zh-V_1
2）、长上下文（Qwen-Long）模型，支持最大1000w的上下文，擅长文档解析，详情可见官方介绍：https://help.aliyun.com/zh/model-studio/long-context-qwen-long?spm=a2c4g.11186623.help-menu-2400256.d_0_1_9_0.b23f67331ztxDU&scm=20140722.H_2846146._.OR_help-T_cn~zh-V_1
但是这个模型到2025年2月就不更新了，我觉得是被官方放弃了，所以优先使用新出的Qwen-Doc-Turbo模型。
这2个模型都支持自动将文档上传到阿里百炼的云盘上，并返回fileId，请查看我给你的官方链接的使用教程，然后把上传完的文档的filedId保存下来，方便后面使用。
我希望你把直接把pdf上传给AI分析，和把pdf转换成markdown的方法都保存下来，变成一个用户可选的可选项。但是程序里要做判断，如果想使用pdf上传给AI分析功能，必须选择Qwen的Qwen-Long或者Qwen-Doc-Turbo模型(你可以做一个配置，里面配上支持直接上传pdf文档的模型，目前我只发现了Qwen和gemini的模型支持这个功能，但也许未来会有其它公司的其它模型也支持原生的pdf上传和解析，所以可以做成一个配置), 除这个配置以外的模型想使用pdf直接上传给AI分析时应该出现报错，提示选择将pdf先转换为markdown的方法
3、progressive_news_summarizer.py中的pdf下载的缓存机制很不错，我希望你能优化并保留下来。最好达到一个文档只需要下载一次的效果
4、progressive_news_summarizer.py中还有一个调用搜索api自动获得新闻的功能，这个功能我想暂时去掉，后面如果需要我会再重构并加回来，但是现在我想暂时去掉。
5、将gemini相关的代码都去掉，我不想使用这个模型，太贵了用不起
